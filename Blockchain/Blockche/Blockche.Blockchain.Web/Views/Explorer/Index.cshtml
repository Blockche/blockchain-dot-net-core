@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@section Scripts{
    @*<script src="https://cdnjs.cloudflare.com/ajax/libs/signalr.js/2.2.3/jquery.signalR.js"></script>*@

    <script src="~/lib/signalr/signalr.min.js"></script>
    <script>
        $(document).ready(function () {

       

         

            $('.btn-filter').on('click', function () {
                var $target = $(this).data('target');
                if ($target != 'all') {
                    $('.table tr').css('display', 'none');
                    $('.table tr[data-status="' + $target + '"]').fadeIn('slow');
                } else {
                    $('.table tr').css('display', 'none').fadeIn('slow');
                }
            });


            const connection = new signalR.HubConnectionBuilder()
                .withUrl("/explorer/data")
                .build();

            connection.on("ReceiveMessage", (data) => {

                //$("#signalRTest").text(JSON.stringify(data));
                var html = ""


                var selectedKind = $('tr.selected').data("status");

                for (var property in data.peers) {
                    if (data.peers.hasOwnProperty(property)) {

                        html += "<tr data-status='peers'> \
<td> \
<div class='media'> \
<div class='media-body'>\
<span class='media-meta pull-right'></span>\
<h4 class='title'>" + data.peers[property] +
"<span class='pull-right pagado'>" + property+"</span>\
</h4>\
<p class='summary'></p>\
</div>\
</div>\
</td >\
</tr >" ;

                    }
                }

                for (var i = 0; i < data.blocks.length; i++) {
                    html += "<tr data-status='last-block'> \
<td> \
<div class='media'> \
<div class='media-body'>\
<span class='media-meta pull-right'></span>\
<h4 class='title'> Block number: " + data.blocks[i].index +
                        "<span class='pull-right pagado'>" + data.blocks[i].minedBy + "</span>\
</h4>\
<p class='summary'>" + data.blocks[i].blockDataHash + "</p>\
</div>\
</div>\
</td >\
</tr >" ;
                }

                for (var i = 0; i < data.pendingTransactions.length; i++) {
                    html += "<tr data-status='pend-tran'> \
<td> \
<div class='media'> \
<div class='media-body'>\
<span class='media-meta pull-right'></span>\
<h4 class='title'> Transaction value: " + data.pendingTransactions[i].value +
                        "<span class='pull-right cancelado'>" + data.pendingTransactions[i].data + "</span>\
</h4>\
<p class='summary'>" + data.pendingTransactions[i].from + " - " + data.pendingTransactions[i].to + "</p>\
</div>\
</div>\
</td >\
</tr >" ;
                }

                for (var i = 0; i < data.confirmedTran.length; i++) {
                    html += "<tr data-status='conf-tran'> \
<td> \
<div class='media'> \
<div class='media-body'>\
<span class='media-meta pull-right'></span>\
<h4 class='title'> Transaction value: " + data.confirmedTran[i].value +
                        "<span class='pull-right pagado'>" + data.confirmedTran[i].data + "</span>\
</h4>\
<p class='summary'>" + data.confirmedTran[i].from + " - " + data.confirmedTran[i].to + "</p>\
</div>\
</div>\
</td >\
</tr >" ;
                }



                $("#chain-table tbody").html(html);

                $('tr[data-status=' + selectedKind + ']').addClass("selected");
                $('.btn-filter[data-target=' + selectedKind + ']').click();

            });

            connection.start().catch(err => console.error(err.toString()));

            // connection.invoke("CheckForNewData").catch(err => console.error(err.toString()));

            setInterval(function myfunction() {
                connection.invoke("CheckForNewData").catch(err => console.error(err.toString()));
            }, 3000);

            //document.getElementById("sendButton").addEventListener("click", event => {
            //    // const user = document.getElementById("userInput").value;
            //    const message = document.getElementById("messageInput").value;
            //    connection.invoke("SendMessage", message).catch(err => console.error(err.toString()));
            //    event.preventDefault();
            //});

        });



    </script>
}

<div id="signalRTest">

</div>

<div class="container">
    <div class="row">&nbsp;</div>
    <div class="row">
        <div class="col-6">&nbsp;</div>
        <div class="col-6">

            Message...<input type="text" id="messageInput" />
            <input type="button" id="sendButton" value="Send Message" />
        </div>
    </div>
    <div class="row">
        <div class="col-12">
            <hr />
        </div>
    </div>
    <div class="row">
        <div class="col-6">&nbsp;</div>
        <div class="col-6">
            <ul id="messagesList"></ul>
        </div>
    </div>
</div>

<div class="container">
    <div class="row">
        <section class="content">
            <h1>NoCoin Explorer of Top 10 entities</h1>

            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-body">
                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-success btn-filter" data-target="last-block">Last blocks</button>
                                <button type="button" class="btn btn-warning btn-filter" data-target="conf-tran">Transactions</button>
                                <button type="button" class="btn btn-danger btn-filter" data-target="pend-tran">Pending Transactions</button>
                                <button type="button" class="btn btn-default btn-filter" data-target="peers">Peers</button>
                                <button type="button" class="btn btn-info btn-filter" data-target="all">All</button>
                            </div>
                        </div>
                        <div class="table-container">
                            <table class="table table-filter" id="chain-table">
                                <tbody>
                                    <tr data-status="peers">

                                        <td>
                                            <div class="media">

                                                <div class="media-body">
                                                    <span class="media-meta pull-right">Febrero 13, 2016</span>
                                                    <h4 class="title">
                                                        Lorem Impsum
                                                        <span class="pull-right pagado">(Pagado)</span>
                                                    </h4>
                                                    <p class="summary">Ut enim ad minim veniam, quis nostrud exercitation...</p>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-status="pend-tran">

                                        <td>
                                            <div class="media">

                                                <div class="media-body">
                                                    <span class="media-meta pull-right">Febrero 13, 2016</span>
                                                    <h4 class="title">
                                                        Lorem Impsum
                                                        <span class="pull-right pagado">(Pagado)</span>
                                                    </h4>
                                                    <p class="summary">Ut enim ad minim veniam, quis nostrud exercitation...</p>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-status="conf-tran">

                                        <td>
                                            <div class="media">

                                                <div class="media-body">
                                                    <span class="media-meta pull-right">Febrero 13, 2016</span>
                                                    <h4 class="title">
                                                        Lorem Impsum
                                                        <span class="pull-right pendiente">(Pendiente)</span>
                                                    </h4>
                                                    <p class="summary">Ut enim ad minim veniam, quis nostrud exercitation...</p>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-status="last-block">

                                        <td>
                                            <div class="media">

                                                <div class="media-body">
                                                    <span class="media-meta pull-right">Febrero 13, 2016</span>
                                                    <h4 class="title">
                                                        Lorem Impsum
                                                        <span class="pull-right cancelado">(Cancelado)</span>
                                                    </h4>
                                                    <p class="summary">Ut enim ad minim veniam, quis nostrud exercitation...</p>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-status="conf-tran" class="selected">

                                        <td>
                                            <div class="media">

                                                <div class="media-body">
                                                    <span class="media-meta pull-right">Febrero 13, 2016</span>
                                                    <h4 class="title">
                                                        Lorem Impsum
                                                        <span class="pull-right pagado">(Pagado)</span>
                                                    </h4>
                                                    <p class="summary">Ut enim ad minim veniam, quis nostrud exercitation...</p>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                    <tr data-status="conf-tran">

                                        <td>
                                            <div class="media">

                                                <div class="media-body">
                                                    <span class="media-meta pull-right">Febrero 13, 2016</span>
                                                    <h4 class="title">
                                                        Lorem Impsum
                                                        <span class="pull-right pendiente">(Pendiente)</span>
                                                    </h4>
                                                    <p class="summary">Ut enim ad minim veniam, quis nostrud exercitation...</p>
                                                </div>
                                            </div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="content-footer">
                    <p>


                    </p>
                </div>
            </div>
        </section>

    </div>
</div>